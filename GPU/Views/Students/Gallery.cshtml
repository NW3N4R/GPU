@model (List<GPU.Models.GalleryModel> ImageList,GPU.Models.StudentDepartmentInfo NewImage,int id)
@using GPU.Helpers;
@{
    ViewData["Title"] = "گەلەری خوێندکار";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>

<div class="GalleryContainer">
    @foreach (var i in Model.ImageList)
    {
        if (!i._Files.FileName.Contains("pdf"))
        {
            <div class="GalleryImageParent">
                @if (i._Files != null)
                {
                    string imageSrc = null;

                    using (var stream = new MemoryStream())
                    {
                        await i._Files.CopyToAsync(stream);
                        var base64Image = Convert.ToBase64String(stream.ToArray());
                        imageSrc = $"data:{i._Files.ContentType};base64,{base64Image}";
                    }

                    <div class="GalleryImage" style="background-image:url('@imageSrc');">
                        <div class="GalleryActionsButton">
                            @if (!i.isPersonal)
                            {
                                <a asp-controller="Students"
                                   asp-action="RemoveImage"
                                   asp-route-id="@i.StudentID"
                                   asp-route-fileName="@i._Files.FileName">
                                    <span class="Segoe">&#xE74D;</span>
                                </a>
                            }
                            <a href="javascript:void(0);" onclick="openImageInNewTab('@imageSrc')">
                                <span class="Segoe">&#xE92D;</span>
                            </a>

                        </div>
                    </div>
                }
            </div>
        }
    }
    @foreach (var pdfs in Model.ImageList)
    {
        if (pdfs._Files.FileName.Contains("pdf"))
        {
            <div class="GalleryImageParent">
                @if (pdfs._Files != null)
                {
                    string imageSrc = null;
                    using (var stream = new MemoryStream())
                    {
                        await pdfs._Files.CopyToAsync(stream);
                        var base64Image = Convert.ToBase64String(stream.ToArray());
                        imageSrc = $"data:application/pdf;base64,{base64Image}";
                    }
                    <div class="GalleryImage" style="background-color: #f0f0f0; display: flex; align-items: center; justify-content: center;">
                        <embed src="@imageSrc" type="application/pdf" class="GalleryImage" />
                        <div class="GalleryActionsButton">
                            @if (!pdfs.isPersonal)
                            {
                                <a asp-controller="Students"
                                   asp-action="RemoveImage"
                                   asp-route-id="@pdfs.StudentID"
                                   asp-route-fileName="@pdfs._Files.FileName">
                                    <span class="Segoe">&#xE74D;</span>
                                </a>
                            }
                            <a href="javascript:void(0);" onclick="openPdfInNewTab('@imageSrc')">
                                <span class="Segoe">&#xE92D;</span>
                            </a>
                        </div>
                    </div>
                }
            </div>
        }
    }
</div>
<form asp-action="NewImage" method="post" id="fileForm" enctype="multipart/form-data">
    <label for="fileInput" class="floating-button">
        <span class="Segoe">&#xE710;</span>
    </label>
    <input type="text" style="display:none;" asp-for="NewImage.Id" name="NewImage.Id" />


    <input asp-for="NewImage.OtherFiles"
           name="NewImage.OtherFiles"
           type="file"
           id="fileInput"
           accept="image/*,application/pdf"
           multiple style="display: none;"
           onchange="submitForm()" />
</form>
<script>
        function openImageInNewTab(imageSrc) {
        var newTab = window.open(); // Open a new tab
        newTab.document.write('<img src="' + imageSrc + '" style="max-width: 100%; max-height: 100vh; object-fit: contain;" />');
        newTab.document.close();
    }
        function openPdfInNewTab(pdfSrc) {
        var newTab = window.open(); // Open a new tab
        newTab.document.write('<embed src="' + pdfSrc + '" type="application/pdf" width="100%" height="100%" />');
        newTab.document.close();
    }
        function submitForm() {
        const form = document.getElementById('fileForm');
        form.submit();  // Submit the form when the file input changes
    }

</script>

